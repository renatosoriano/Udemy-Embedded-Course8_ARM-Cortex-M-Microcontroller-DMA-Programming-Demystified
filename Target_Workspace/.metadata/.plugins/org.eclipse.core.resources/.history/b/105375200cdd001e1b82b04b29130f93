/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include "stm32f446xx.h"

//function prototypes of the init & configuration functions
void button_init(void);
void uart2_init(void);
void dma1_init(void);


#define BASE_ADDR_OF_GPIOC_PERI  GPIOC
int main(void)
{
	button_init();
	uart2_init();
	dma1_init();
	while(1);

	return 0;
}
void button_init(void)
{
	//button is connected to PC13 . GPIOC pin number 13. 
	
	GPIO_TypeDef *pGPIOC;
	pGPIOC = BASE_ADDR_OF_GPIOC_PERI;
	
	RCC_TypeDef *pRCC;
	pRCC = RCC;
	
	EXTI_TypeDef *pEXTI;
	pEXTI = EXTI;
	
	SYSCFG_TypeDef *pSYSCFG;
	pSYSCFG = SYSCFG;
	
	//1. enable the peripheral clock for the GPIOC peripheral 
	pRCC->AHB1ENR |= ( 1 << 2);
	
	//2. Keep the gpio pin in input mode
	pGPIOC->MODER &= ~( 0x3 << 26) ;
	
	//3. Enable the interrupt over that gpio pin
	pEXTI->IMR |= (1 << 13);
	
	//4. Enable the clock for SYSCFG 
	pRCC->APB2ENR |= ( 1 << 14);
	
	//5. Configuring the SYSCFG CR4 register 
	pSYSCFG->EXTICR[3] &= ~(0xF << 4); //Clearing 
	pSYSCFG->EXTICR[3] |=  (0x2 << 4); //set
	
	//6. Configure the edge detection for the EXTI 13 line. 
	pEXTI->FTSR |= ( 1 << 13);

	//7. Enable the IRQ related to that gpio pin in NVIC register of the processor . 
	NVIC_EnableIRQ(EXTI15_10_IRQn);
	
}

void uart2_init(void)
{
	RCC_TypeDef *pRCC;
	pRCC = RCC;
	
	GPIO_TypeDef *pGPIOA;
	pGPIOA = GPIOA;
	
	USART_TypeDef *pUART2;
	pUART2 = USART2;
	
	//1. enable the peripheral clock for the uart2 peripheral 
	pRCC->APB1ENR |= ( 1 << 17);
	
	//2. Configure the gpio pins for uart_tx and uart_rx functionality 
	     //PA2 as TX , PA3 as RX
	
	// lets configure PA2 as UART2 TX
	
  	//2.1 Enable the clock for the GPIOA peripheral 
	pRCC->AHB1ENR |= ( 1 << 0);

	//2.2 Change the mode of the PA2 to alternate function mode
	pGPIOA->MODER &= ~(0x3 << 4); 
	pGPIOA->MODER |= (0x2 << 4);
	pGPIOA->AFR[0] &= ~( 0xF << 8);
	pGPIOA->AFR[0] |= ( 0x7 << 8);
  
	//2.3 Enable or disable Pull-up resistor of the gpio pin if required. 
	pGPIOA->PUPDR |= (0x1 << 4);//enables the pull up resistor on the gpio A pin number 2

	// lets configure PA3 as UART2 RX

	//2.4 Change the mode of the PA3 to alternate function mode
	pGPIOA->MODER  &= ~(0x3 << 6); 
	pGPIOA->MODER  |=  (0x2 << 6);
	pGPIOA->AFR[0] &= ~( 0xF << 12);
	pGPIOA->AFR[0] |=  ( 0x7 << 12);
  
	//2.5 Enable or disable Pull-up resistor for PA3	
	pGPIOA->PUPDR |= (0x1 << 6);
	
	//3 . Configure the baudrate 
	pUART2->BRR = 0x8B;
	
	//4 . configure the data width, no of stop bits , etc 
	// <no configuration req here , we will use default values 
	
	//5.  Enable the TX engine of the uart peripheral 
	pUART2->CR1 |= ( 1 << 3);
	
	//6.  Enable the uart peripheral 
	pUART2->CR1 |= ( 1 << 13);
	
}

void dma1_init(void)
{

}
